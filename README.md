## List of experiments currently supported
1. Round trip latency - 'ping'
2. Available bandwidth - 'iperf', 'netperf'
3. Throughput - 'scp', 'rsync', 'gridFTP'

## Running the scripts
Clone the repository on both the sender and receiver servers. 
```shell
$ git clone https://github.com/coscin/network_measurements.git
$ cd network_measurments/
```
This will be our working directory

### Running the network measurement script
Run this script on both the sender and receiver servers (receiver first)

```shell
$ python scripts/net_measurements.py [--sender/--receiver] -i <interface used for sending/receiving> -s <source IP address> -d <remote IP address> --experiment [RTlatency/available_bandwidth/throughput]
```

Use --sender option on the server sending the data and --receiver option on the server receiving the data

### Running the visualization script (for creating graphs)
```shell
$ python scripts/visualize.py
```

## Script working details

### experiments.py
This file contains the scripts to start various network measurement applications. There is one module per application and all the modules follow the same template, making the addition of new applications very easy.

### net_measurements.py
This file calls various applications implemented in *experiments.py* and stores the raw data generated by those applications into flat files (currently stats are being collected every 1 sec). For the Round trip latency experiment, which runs 'ping', the stats stored in the flat files are the ones generated by the 'ping' application itself, but for Available bandwidth and Throughput experiments, the stats are calculated using 'tcpstat' listening on the right port. Thus there is a clear separation between the actual experiment and stat collection, which makes addition of new measurement applications extremely easy for these two types of experiments.

### visualize.py
This file formats the raw data generated by *net_measurements.py* into comma-separated time-series data and plots the corresponding graphs using 'gnuplot' application. The graphs are stored in .png format.

## Data storage hierarchy
Data generated by net_measurements.py is stored in the following manner -
A directory is created for each of the 3 basic experiments. They are - **round_trip_latency/**, **available_bandwidth/** and **throughput/**. Inside each of these directories, there is a sub-directory corresponding to every tool running that corresponding experiment. So we will have a **ping/** sub-directory inside **round_trip_latency/** directory, **iperf/** and **netperf/** sub-directories inside the **available_bandwidth/** directory and so on. Then the stats are stored in flat files in the corresponding directories. All these directories are created and managed by the script.

Data generated by visualize.py is stored in a similar manner, except now the base directories are named as - **round_trip_latency_graphs/**, **available_bandwidth_graphs/** and **throughput_graphs/**

So to view the graphs of the throughput experiment carried out via rsync, one will do -
```shell
$ cd throughput_graphs/rsync/
```
and open the corresponding .png file

## File naming and management
The raw data generated by various network measurement tools are not timestamped. The script handles this issue by naming each file storing the stats as the start time of the experiment, with the stats being collected at the granularity of 1 sec. This implicitly timestamps every data generated by the network measurement tools. After a fixed time interval (a configurable parameter, default 24 hrs), a new file is created and stats are written to the new file, to ensure that the data collected is distributed across several files rather than having a single very large file. For the visualization purpose, the data of all the files inside a folder are concatenated into a single file and the corresponding graph is plotted.

**TODO:** Add feature where the user can specify the start and end times, so that the visualization script will create graph for only that period rather than the default entire duration of the experiment.



